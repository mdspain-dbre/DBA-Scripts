What is this code doing?

Sharels Upgrade of Mongo Biniaries. 
Using Package management is not recommended 
as it can at times add new artifacts into the instance as well as delete data and config files 

Notes from Claude 

Extract the archive - Uncompresses the MongoDB tarball
Move to standard location - Places MongoDB in /opt/mongodb
Backup old binaries - Saves any existing mongod and mongo commands (with .bak extension)
Create symlinks - Links the new MongoDB binaries to system paths so commands like mongod and mongo work globally
Edit service file - Opens the systemd service configuration file for MongoDB (likely to set permissions, working directory, etc.)
Reload systemd - Refreshes systemd to recognize the service changes
Enable & start service - Configures MongoDB to auto-start on boot and starts it
Restart & verify - Restarts MongoDB and checks its status
Connect to MongoDB - Launches the MongoDB shell to verify the installation works
Summary: It's a clean upgrade that backs up the old version, installs the new one, configures it as a system service, and verifies connectivity.

/******************************************************/
/******************************************************/


tar -xvzf mongodb-linux-x86_64-ubuntu1604-3.4.24.tgz
sudo mv mongodb-linux-x86_64-ubuntu1604-3.4.24 /opt/mongodb
sudo mv /usr/bin/mongod /usr/bin/mongod.bak
sudo mv /usr/bin/mongo /usr/bin/mongo.bak
sudo ln -s /opt/mongodb/bin/mongod /usr/bin/mongod
sudo ln -s /opt/mongodb/bin/mongo /usr/bin/mongo
sudo vim /etc/systemd/system/mongod.service
sudo systemctl daemon-reload
sudo systemctl enable mongod
sudo systemctl start mongod
sudo systemctl restart mongod
sudo systemctl status mongod
mongo


/******************************************************/
/******************************************************/



/******************************************************/
/******************************************************/
To find replication lag in MongoDB, you can use several methods:
/******************************************************/
/******************************************************/

1. rs.status() - Most Common Method

    Look at the optimeDate field for each member. Calculate the difference between the primary and secondary timestamps to get the lag.

2. rs.printReplicationInfo() - Primary Lag

    Shows the oplog size and time window on the primary.

3. rs.printSecondaryReplicationInfo() - Secondary Lag

This will loop through the nodes to return lag time 

/******************************************************/
/******************************************************/

var status = rs.status();
var primary = status.members.find(m => m.stateStr === "PRIMARY");
var secondaries = status.members.filter(m => m.stateStr === "SECONDARY");

secondaries.forEach(s => {
    var lag = (primary.optimeDate - s.optimeDate) / 1000;
    print(s.name + " lag: " + lag + " seconds");
});
/******************************************************/
/******************************************************/

/******************************************************/
/******************************************************/
Determine how long the OpLog is good for 
/******************************************************/
/******************************************************/
rs.printReplicationInfo()

/******************************************************/
/******************************************************/
NetWork Share for MongoDB 4.4.30 msi 
/******************************************************/
/******************************************************/

\\IP-0A74643F\Mongo4.4


/******************************************************/
/******************************************************/
find feature compatibility version (FCV)
/******************************************************/
/******************************************************/

db.adminCommand({ getParameter: 1, featureCompatibilityVersion: 1 })

db.adminCommand({ setFeatureCompatibilityVersion: "4.4" })

/******************************************************/
/******************************************************/
Return members of replica set
/******************************************************/
/******************************************************/

rs.status().members.forEach(m => printjson({_id: m._id, name: m.name , stateStr: m.stateStr}))


/******************************************************/
/******************************************************/
When upgrading MongoDB on Windows, you need to replace these binaries:
/******************************************************/
/******************************************************/


Core binaries to replace:

mongod.exe - MongoDB server daemon
mongo.exe - MongoDB shell (legacy, removed in 6.0+)
mongos.exe - MongoDB sharded cluster query router (if using sharding)
Additional binaries included:

mongodump.exe - Backup utility
mongorestore.exe - Restore utility
mongoexport.exe - Export utility
mongoimport.exe - Import utility
mongostat.exe - Statistics tool
mongotop.exe - Tracking tool
bsondump.exe - BSON utility

# Stop MongoDB service
Stop-Service MongoDB

# Backup current binaries
Copy-Item "C:\Program Files\MongoDB\Server\3.4\bin" "C:\Program Files\MongoDB\Server\3.4\bin.bak" -Recurse

# Install new MSI from network share
# \\IP-0A74643F\Mongo4.4\mongodb-windows-x86_64-4.4.30.msi

# Or manually replace binaries in:
# C:\Program Files\MongoDB\Server\4.4\bin\

# Start MongoDB service
Start-Service MongoDB

# Verify version
& "C:\Program Files\MongoDB\Server\4.4\bin\mongo.exe" --eval "db.version()"